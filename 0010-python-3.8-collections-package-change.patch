From 15b5ec84c376c5ac8414c9a93cfef301a335ec5b Mon Sep 17 00:00:00 2001
From: Ganesh Maharaj Mahalingam <ganesh.mahalingam@intel.com>
Date: Fri, 5 Oct 2018 03:32:13 +0000
Subject: [PATCH 10/10] python 3.8 collections package change

Signed-off-by: Ganesh Maharaj Mahalingam <ganesh.mahalingam@intel.com>
---
 qa/tasks/cephfs/test_data_scan.py                         | 5 ++++-
 qa/tasks/cephfs/test_forward_scrub.py                     | 5 ++++-
 qa/tasks/cephfs/test_recovery_pool.py                     | 5 ++++-
 qa/tasks/cephfs/test_scrub.py                             | 5 ++++-
 qa/tasks/mgr/dashboard/helper.py                          | 5 ++++-
 qa/tasks/vstart_runner.py                                 | 5 ++++-
 .../zipkin/src/zipkin_logic/zipkin_client.py              | 5 ++++-
 src/ceph-volume/ceph_volume/__init__.py                   | 5 ++++-
 src/pybind/ceph_daemon.py                                 | 5 ++++-
 src/pybind/cephfs/cephfs.pyx                              | 5 ++++-
 src/pybind/mgr/dashboard/controllers/cephfs.py            | 5 ++++-
 src/pybind/mgr/dashboard/services/ceph_service.py         | 8 ++++++--
 src/pybind/mgr/dashboard/tests/test_task.py               | 5 ++++-
 src/pybind/mgr/mgr_module.py                              | 5 ++++-
 src/pybind/mgr/restful/api/crush.py                       | 5 ++++-
 src/pybind/mgr/status/module.py                           | 5 ++++-
 src/pybind/mgr/telemetry/module.py                        | 5 ++++-
 src/pybind/rados/rados.pyx                                | 5 ++++-
 src/pybind/rbd/rbd.pyx                                    | 5 ++++-
 src/pybind/rgw/rgw.pyx                                    | 5 ++++-
 .../ip_pipeline/config/pipeline-to-core-mapping.py        | 5 ++++-
 src/spdk/test/blobfs/rocksdb/postprocess.py               | 5 ++++-
 src/tools/rgw/parse-cr-dump.py                            | 5 ++++-
 23 files changed, 94 insertions(+), 24 deletions(-)

diff --git a/qa/tasks/cephfs/test_data_scan.py b/qa/tasks/cephfs/test_data_scan.py
index 25235469..29a15cd6 100644
--- a/qa/tasks/cephfs/test_data_scan.py
+++ b/qa/tasks/cephfs/test_data_scan.py
@@ -8,7 +8,10 @@ import logging
 import os
 from textwrap import dedent
 import traceback
-from collections import namedtuple, defaultdict
+try:
+    from collections.abc import namedtuple, defaultdict
+except ImportError:
+    from collections import namedtuple, defaultdict
 
 from teuthology.orchestra.run import CommandFailedError
 from tasks.cephfs.cephfs_test_case import CephFSTestCase, for_teuthology
diff --git a/qa/tasks/cephfs/test_forward_scrub.py b/qa/tasks/cephfs/test_forward_scrub.py
index 1f80366a..a03cc7f1 100644
--- a/qa/tasks/cephfs/test_forward_scrub.py
+++ b/qa/tasks/cephfs/test_forward_scrub.py
@@ -10,7 +10,10 @@ how the functionality responds to damaged metadata.
 import json
 
 import logging
-from collections import namedtuple
+try:
+    from collections.abc import namedtuple
+except ImportError:
+    from collections import namedtuple
 from textwrap import dedent
 
 from teuthology.orchestra.run import CommandFailedError
diff --git a/qa/tasks/cephfs/test_recovery_pool.py b/qa/tasks/cephfs/test_recovery_pool.py
index 097342a9..631db030 100644
--- a/qa/tasks/cephfs/test_recovery_pool.py
+++ b/qa/tasks/cephfs/test_recovery_pool.py
@@ -8,7 +8,10 @@ import logging
 import os
 from textwrap import dedent
 import traceback
-from collections import namedtuple, defaultdict
+try:
+    from collections.abc import namedtuple, defaultdict
+except ImportError:
+    from collections import namedtuple, defaultdict
 
 from teuthology.orchestra.run import CommandFailedError
 from tasks.cephfs.cephfs_test_case import CephFSTestCase, for_teuthology
diff --git a/qa/tasks/cephfs/test_scrub.py b/qa/tasks/cephfs/test_scrub.py
index 9469dfce..4cc4f7f0 100644
--- a/qa/tasks/cephfs/test_scrub.py
+++ b/qa/tasks/cephfs/test_scrub.py
@@ -4,7 +4,10 @@ Test CephFS scrub (distinct from OSD scrub) functionality
 import logging
 import os
 import traceback
-from collections import namedtuple
+try:
+    from collections.abc import namedtuple
+except ImportError:
+    from collections import namedtuple
 
 from teuthology.orchestra.run import CommandFailedError
 from tasks.cephfs.cephfs_test_case import CephFSTestCase, for_teuthology
diff --git a/qa/tasks/mgr/dashboard/helper.py b/qa/tasks/mgr/dashboard/helper.py
index 1be8243d..d64bd53b 100644
--- a/qa/tasks/mgr/dashboard/helper.py
+++ b/qa/tasks/mgr/dashboard/helper.py
@@ -4,7 +4,10 @@ from __future__ import absolute_import
 
 import json
 import logging
-from collections import namedtuple
+try:
+    from collections.abc import namedtuple
+except ImportError:
+    from collections import namedtuple
 import threading
 import time
 
diff --git a/qa/tasks/vstart_runner.py b/qa/tasks/vstart_runner.py
index 3c8134ec..1682e8b8 100644
--- a/qa/tasks/vstart_runner.py
+++ b/qa/tasks/vstart_runner.py
@@ -26,7 +26,10 @@ Alternative usage:
 """
 
 from StringIO import StringIO
-from collections import defaultdict
+try:
+    from collections.abc import defaultdict
+except ImportError:
+    from collections import defaultdict
 import getpass
 import signal
 import tempfile
diff --git a/src/blkin/babeltrace-plugins/zipkin/src/zipkin_logic/zipkin_client.py b/src/blkin/babeltrace-plugins/zipkin/src/zipkin_logic/zipkin_client.py
index 28118fac..963678b8 100644
--- a/src/blkin/babeltrace-plugins/zipkin/src/zipkin_logic/zipkin_client.py
+++ b/src/blkin/babeltrace-plugins/zipkin/src/zipkin_logic/zipkin_client.py
@@ -2,7 +2,10 @@
 
 from scribe_client import ScribeClient
 from trace import Annotation, Trace, Endpoint
-from collections import defaultdict
+try:
+    from collections.abc import defaultdict
+except ImportError:
+    from collections import defaultdict
 from formatters import base64_thrift_formatter
 
 
diff --git a/src/ceph-volume/ceph_volume/__init__.py b/src/ceph-volume/ceph_volume/__init__.py
index 1c03ae3b..595fd2b2 100644
--- a/src/ceph-volume/ceph_volume/__init__.py
+++ b/src/ceph-volume/ceph_volume/__init__.py
@@ -1,4 +1,7 @@
-from collections import namedtuple
+try:
+    from collections.abc import namedtuple
+except ImportError:
+    from collections import namedtuple
 
 
 sys_info = namedtuple('sys_info', ['devices'])
diff --git a/src/pybind/ceph_daemon.py b/src/pybind/ceph_daemon.py
index b1c5750f..9b55613f 100644
--- a/src/pybind/ceph_daemon.py
+++ b/src/pybind/ceph_daemon.py
@@ -15,7 +15,10 @@ import json
 import socket
 import struct
 import time
-from collections import OrderedDict
+try:
+    from collections.abc import OrderedDict
+except ImportError:
+    from collections import OrderedDict
 from fcntl import ioctl
 from fnmatch import fnmatch
 from prettytable import PrettyTable, HEADER
diff --git a/src/pybind/cephfs/cephfs.pyx b/src/pybind/cephfs/cephfs.pyx
index 47f2b1ea..1c7c1a21 100644
--- a/src/pybind/cephfs/cephfs.pyx
+++ b/src/pybind/cephfs/cephfs.pyx
@@ -9,7 +9,10 @@ from libc.stdlib cimport malloc, realloc, free
 
 cimport rados
 
-from collections import namedtuple
+try:
+    from collections.abc import namedtuple
+except ImportError:
+    from collections import namedtuple
 from datetime import datetime
 import errno
 import os
diff --git a/src/pybind/mgr/dashboard/controllers/cephfs.py b/src/pybind/mgr/dashboard/controllers/cephfs.py
index 59b57174..147235fc 100644
--- a/src/pybind/mgr/dashboard/controllers/cephfs.py
+++ b/src/pybind/mgr/dashboard/controllers/cephfs.py
@@ -1,7 +1,10 @@
 # -*- coding: utf-8 -*-
 from __future__ import absolute_import
 
-from collections import defaultdict
+try:
+    from collections.abc import defaultdict
+except ImportError:
+    from collections import defaultdict
 
 import cherrypy
 
diff --git a/src/pybind/mgr/dashboard/services/ceph_service.py b/src/pybind/mgr/dashboard/services/ceph_service.py
index 4925f806..d32d6262 100644
--- a/src/pybind/mgr/dashboard/services/ceph_service.py
+++ b/src/pybind/mgr/dashboard/services/ceph_service.py
@@ -2,8 +2,12 @@
 from __future__ import absolute_import
 
 import time
-import collections
-from collections import defaultdict
+try:
+    import collections.abc
+    from collections.abc import defaultdict
+except ImportError:
+    import collections
+    from collections import defaultdict
 import json
 
 from mgr_module import CommandResult
diff --git a/src/pybind/mgr/dashboard/tests/test_task.py b/src/pybind/mgr/dashboard/tests/test_task.py
index 0547a00a..1f5b415e 100644
--- a/src/pybind/mgr/dashboard/tests/test_task.py
+++ b/src/pybind/mgr/dashboard/tests/test_task.py
@@ -5,7 +5,10 @@ import json
 import unittest
 import threading
 import time
-from collections import defaultdict
+try:
+    from collections.abc import defaultdict
+except ImportError:
+    from collections import defaultdict
 
 from ..tools import NotificationQueue, TaskManager, TaskExecutor
 
diff --git a/src/pybind/mgr/mgr_module.py b/src/pybind/mgr/mgr_module.py
index f1e5c127..16a10807 100644
--- a/src/pybind/mgr/mgr_module.py
+++ b/src/pybind/mgr/mgr_module.py
@@ -5,7 +5,10 @@ import json
 import logging
 import six
 import threading
-from collections import defaultdict
+try:
+    from collections.abc import defaultdict
+except ImportError:
+    from collections import defaultdict
 import rados
 
 
diff --git a/src/pybind/mgr/restful/api/crush.py b/src/pybind/mgr/restful/api/crush.py
index ee8589df..6b2b3646 100644
--- a/src/pybind/mgr/restful/api/crush.py
+++ b/src/pybind/mgr/restful/api/crush.py
@@ -2,7 +2,10 @@ from pecan import expose
 from pecan.rest import RestController
 
 from restful import common, context
-from collections import defaultdict
+try:
+    from collections.abc import defaultdict
+except ImportError:
+    from collections import defaultdict
 
 from restful.decorators import auth
 
diff --git a/src/pybind/mgr/status/module.py b/src/pybind/mgr/status/module.py
index 0467cf2b..9866f693 100644
--- a/src/pybind/mgr/status/module.py
+++ b/src/pybind/mgr/status/module.py
@@ -3,7 +3,10 @@
 High level status display commands
 """
 
-from collections import defaultdict
+try:
+    from collections.abc import defaultdict
+except ImportError:
+    from collections import defaultdict
 from prettytable import PrettyTable
 import errno
 import fnmatch
diff --git a/src/pybind/mgr/telemetry/module.py b/src/pybind/mgr/telemetry/module.py
index f83ddfe2..7fd1601e 100644
--- a/src/pybind/mgr/telemetry/module.py
+++ b/src/pybind/mgr/telemetry/module.py
@@ -12,7 +12,10 @@ import uuid
 import time
 from datetime import datetime
 from threading import Event
-from collections import defaultdict
+try:
+    from collections.abc import defaultdict
+except ImportError:
+    from collections import defaultdict
 
 from mgr_module import MgrModule
 
diff --git a/src/pybind/rados/rados.pyx b/src/pybind/rados/rados.pyx
index 03c3338c..893c26c6 100644
--- a/src/pybind/rados/rados.pyx
+++ b/src/pybind/rados/rados.pyx
@@ -23,7 +23,10 @@ import sys
 import threading
 import time
 
-from collections import Callable
+try:
+    from collections.abc import Callable
+except ImportError:
+    from collections import Callable
 from datetime import datetime
 from functools import partial, wraps
 from itertools import chain
diff --git a/src/pybind/rbd/rbd.pyx b/src/pybind/rbd/rbd.pyx
index 62aff653..62939b41 100644
--- a/src/pybind/rbd/rbd.pyx
+++ b/src/pybind/rbd/rbd.pyx
@@ -23,7 +23,10 @@ from libc.stdint cimport *
 from libc.stdlib cimport realloc, free
 from libc.string cimport strdup
 
-from collections import Iterable
+try:
+    from collections.abc import Iterable
+except ImportError:
+    from collections import Iterable
 from datetime import datetime
 
 cimport rados
diff --git a/src/pybind/rgw/rgw.pyx b/src/pybind/rgw/rgw.pyx
index f512d33f..39476aac 100644
--- a/src/pybind/rgw/rgw.pyx
+++ b/src/pybind/rgw/rgw.pyx
@@ -10,7 +10,10 @@ from libc.stdlib cimport malloc, realloc, free
 
 cimport rados
 
-from collections import namedtuple
+try:
+    from collections.abc import namedtuple
+except ImportError:
+    from collections import namedtuple
 from datetime import datetime
 import errno
 
diff --git a/src/spdk/dpdk/examples/ip_pipeline/config/pipeline-to-core-mapping.py b/src/spdk/dpdk/examples/ip_pipeline/config/pipeline-to-core-mapping.py
index 7a4eaa20..1e5c7741 100755
--- a/src/spdk/dpdk/examples/ip_pipeline/config/pipeline-to-core-mapping.py
+++ b/src/spdk/dpdk/examples/ip_pipeline/config/pipeline-to-core-mapping.py
@@ -39,7 +39,10 @@
 #
 
 from __future__ import print_function
-from collections import namedtuple
+try:
+    from collections.abc import namedtuple
+except ImportError:
+    from collections import namedtuple
 import argparse
 import array
 import errno
diff --git a/src/spdk/test/blobfs/rocksdb/postprocess.py b/src/spdk/test/blobfs/rocksdb/postprocess.py
index ec18fc56..7425bed9 100755
--- a/src/spdk/test/blobfs/rocksdb/postprocess.py
+++ b/src/spdk/test/blobfs/rocksdb/postprocess.py
@@ -1,5 +1,8 @@
 #!/usr/bin/env python
-from collections import namedtuple
+try:
+    from collections.abc import namedtuple
+except ImportError:
+    from collections import namedtuple
 from itertools import islice
 import operator
 import sys
diff --git a/src/tools/rgw/parse-cr-dump.py b/src/tools/rgw/parse-cr-dump.py
index 539929b1..e979cf33 100755
--- a/src/tools/rgw/parse-cr-dump.py
+++ b/src/tools/rgw/parse-cr-dump.py
@@ -1,6 +1,9 @@
 #!/usr/bin/python
 from __future__ import print_function
-from collections import Counter
+try:
+    from collections.abc import Counter
+except ImportError:
+    from collections import Counter
 import argparse
 import json
 import re
-- 
2.19.0

